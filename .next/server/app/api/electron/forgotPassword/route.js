"use strict";(()=>{var e={};e.id=1130,e.ids=[1130],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},92761:e=>{e.exports=require("node:async_hooks")},6005:e=>{e.exports=require("node:crypto")},13725:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>b,staticGenerationAsyncStorage:()=>w});var r={};a.r(r),a.d(r,{POST:()=>f});var s=a(73278),n=a(45002),i=a(54877),c=a(51418),o=a(71309),d=a(84770),u=a.n(d),l=a(82208);async function f(e){try{let{email:t}=await e.json();if(!t)return o.NextResponse.json({status:400,data:"Invalid Email format"});let a=u().randomBytes(32).toString("hex"),r=new Date(Date.now()+36e5);if(!await l.L.user.findUnique({where:{email:t}}))return o.NextResponse.json({status:400,data:"Emailid not registered"});let s=await l.L.userElectron.upsert({where:{email:t},create:{email:t},update:{}});await l.L.resetToken.create({data:{token:a,expiry:r,userId:s.id}});let n=`http://devsonline.in:3000//reset-password/${a}`,{transporter:i,mailOptions:d}=await (0,c.sendEmail)(t,"Set your password",`Link is valid for 1hr ${n}`);return i.sendMail(d,async(e,t)=>{if(e)return o.NextResponse.json({status:400,data:"Error in sending email"});console.log("\uD83D\uDC4D Email send",t)}),o.NextResponse.json({status:200,data:"Email sent"})}catch(e){return o.NextResponse.json({status:500,data:"Internal Server error"})}}let p=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/electron/forgotPassword/route",pathname:"/api/electron/forgotPassword",filename:"route",bundlePath:"app/api/electron/forgotPassword/route"},resolvedPagePath:"C:\\Users\\Prajval Bhardwaj\\Desktop\\opal_codes\\video\\src\\app\\api\\electron\\forgotPassword\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:w,serverHooks:b}=p,h="/api/electron/forgotPassword/route";function g(){return(0,i.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:w})}},69757:(e,t,a)=>{e.exports=a(30170).vendored["react-rsc"].ReactDOM},48278:(e,t,a)=>{e.exports=a(30170).vendored["react-rsc"].ReactServerDOMWebpackServerEdge},73278:(e,t,a)=>{e.exports=a(30517)},51418:(e,t,a)=>{a.r(t),a.d(t,{$$ACTION_0:()=>d,$$ACTION_1:()=>l,$$ACTION_10:()=>N,$$ACTION_2:()=>p,$$ACTION_3:()=>w,$$ACTION_4:()=>h,$$ACTION_5:()=>x,$$ACTION_6:()=>y,$$ACTION_7:()=>k,$$ACTION_8:()=>I,$$ACTION_9:()=>L,acceptInvite:()=>A,createCommentAndReply:()=>v,enableFirstView:()=>g,getFirstView:()=>b,getPaymentInfo:()=>m,getUserProfile:()=>j,getVideoComments:()=>q,inviteMembers:()=>$,onAuthenticatedUser:()=>u,searchUsers:()=>f,sendEmail:()=>o});var r=a(94214);a(84674);var s=a(82208),n=a(54572),i=a(56742),c=a(54772);let o=(0,r.j)("149bd4fa66f1001c6a08172ef29464929f3d4090",d);async function d(e,t,a,r){let s=i.createTransport({host:"smtp.gmail.com",port:465,secure:!0,auth:{user:process.env.MAILER_EMAIL,pass:process.env.MAILER_PASSWORD}});return console.log("user",process.env.MAILER_EMAIL),console.log("pass->",process.env.MAILER_PASSWORD),{transporter:s,mailOptions:{to:e,subject:t,text:a,html:r}}}let u=(0,r.j)("f5937d3bade8e82b830e94e4b496464cb12b8a15",l);async function l(){try{let e=await (0,n.a)();if(!e)return{status:403};console.log("user->exist in clerk");let t=await s.L.user.findUnique({where:{clerkid:e.id},include:{workspace:!0}});if(t)return console.log("user exist in db"),{status:200,user:t};let a=await s.L.user.create({data:{clerkid:e.id,email:e.emailAddresses[0].emailAddress,firstname:e.firstName,lastname:e.lastName,image:e.imageUrl,studio:{create:{}},subscription:{create:{}},workspace:{create:{name:`${e.firstName}'s Workspace`,type:"PERSONAL",folders:{create:{}}}}},include:{workspace:!0,subscription:{select:{plan:!0}}}});if(a)return console.log("newUser created"),{status:201,user:a};return{status:400}}catch(e){return console.log("error->",e),{status:500}}}let f=(0,r.j)("0c23c25bb8cc800e0bd8599528b9af021793ae3f",p);async function p(e){try{let t=await (0,n.a)();if(!t)return{status:404};let a=await s.L.user.findMany({where:{OR:[{firstname:{contains:e}},{email:{contains:e}},{lastname:{contains:e}}],NOT:[{clerkid:t.id}]},select:{id:!0,subscription:{select:{plan:!0}},firstname:!0,lastname:!0,image:!0,email:!0}});if(console.log("query->",e),console.log("users->",a),a&&a.length>0)return{status:200,data:a};return{status:404,data:void 0}}catch(e){return{status:500,data:void 0}}}let m=(0,r.j)("44f693dffbb0e9f6c05d188c74002f2f93ebdf3a",w);async function w(){try{let e=await (0,n.a)();if(!e)return{status:404};let t=await s.L.user.findUnique({where:{clerkid:e.id},select:{subscription:{select:{plan:!0}}}});if(t)return{status:200,data:t}}catch(e){return{status:400}}}let b=(0,r.j)("7c89b82e980c1d67f230f337aeeaca08b4eab4ff",h);async function h(){try{let e=await (0,n.a)();if(!e)return{status:404};let t=await s.L.user.findUnique({where:{clerkid:e.id},select:{firstView:!0}});if(console.log("userData->",t),t)return{status:200,data:t.firstView};return{status:400,data:!1}}catch(e){return{status:500}}}let g=(0,r.j)("ddfb883df2838eb0c1b54a147f7879ca6090977b",x);async function x(e){try{let t=await (0,n.a)();if(!t)return{status:404};if(await s.L.user.update({where:{clerkid:t.id},data:{firstView:e}}))return{status:200,data:"Setting updated"}}catch(e){return{status:400}}}let v=(0,r.j)("929f3cd0c3d84342af07108b97c32d8f0ebdafd5",y);async function y(e,t,a,r){try{if(r&&await s.L.comment.update({where:{id:r},data:{reply:{create:{comment:t,userId:e,videoId:a}}}}))return{status:200,data:"Reply posted"};if(await s.L.video.update({where:{id:a},data:{Comment:{create:{comment:t,userId:e}}}}))return{status:200,data:"New comment added"};return{status:400}}catch(e){return{status:500}}}let j=(0,r.j)("e04a2b5acfd82ae12c360589f4c1aec5aec5d7cb",k);async function k(){try{let e=await (0,n.a)();if(!e)return{status:404};let t=await s.L.user.findUnique({where:{clerkid:e.id},select:{image:!0,id:!0}});if(console.log("user_profile->",t),t)return console.log({status:200,data:t}),{status:200,data:t};return{status:404}}catch(e){return{status:500}}}let q=(0,r.j)("336dc2106c66faedd416a4446e7a0525401b3779",I);async function I(e){try{let t=await s.L.comment.findMany({where:{OR:[{videoId:e},{commentId:e}],commentId:null},include:{reply:{include:{User:!0}},User:!0}});return{status:200,data:t}}catch(e){return{status:500}}}let $=(0,r.j)("3d84e929aca4af4afd4387970a343b8a347e736d",L);async function L(e,t,a){try{let r=await (0,n.a)();if(!r)return{status:404};let i=await s.L.user.findUnique({where:{clerkid:r.id},select:{id:!0,firstname:!0,lastname:!0}});if(i?.id){let n=await s.L.workSpace.findUnique({where:{id:e},select:{name:!0}});if(n){let c=await s.L.invite.create({data:{senderId:i.id,recieverId:t,workSpaceId:e,content:`You are invite to join ${n.name} Workspace, click accept to confirm`},select:{id:!0}});if(await s.L.user.update({where:{clerkid:r.id},data:{notification:{create:{content:`${r.firstName} ${r.lastName} invited ${i.firstname} into ${n.name}`}}}}),c){console.log("invitation reached");let{transporter:e,mailOptions:t}=await o(a,"You got an invitation",`You are invited to join ${n.name} Workspace, click accept to confirm`,`<a href="http://devsonline.in:3000//invite/${c.id}" style="background-color: #000; padding: 5px 10px; border-radius: 10px;">Accept Invite</a>`);return e.sendMail(t,async(e,t)=>{e?console.log("\uD83C\uDF0B",e.message):console.log("\uD83D\uDC4D Email send",t)}),{status:200,data:"Invite sent"}}return{status:400,data:"Invitation failed"}}return{status:404,data:"workspace not found"}}return{status:404,data:"recipient not found"}}catch(e){return{status:500,data:"Oops!something went wrong"}}}let A=(0,r.j)("2bcdaf06ff4efd35fdf89a90b7f656532f5dfa1f",N);async function N(e){try{let t=await (0,n.a)();if(!t)return{status:404};let a=await s.L.invite.findUnique({where:{id:e},select:{workSpaceId:!0,reciever:{select:{clerkid:!0}}}});if(t.id!==a?.reciever?.clerkid)return{status:401};let r=s.L.invite.update({where:{id:e},data:{accepted:!0}}),i=s.L.user.update({where:{clerkid:t.id},data:{members:{create:{workSpaceId:a.workSpaceId}}}});if(await s.L.$transaction([r,i]))return{status:200};return{status:400}}catch(e){return{status:500}}}(0,c.h)([o,u,f,m,b,g,v,j,q,$,A]),(0,r.j)("85fce81cefd5ec11403ca638c8ea519365fe2c55",o),(0,r.j)("79ca4d548d125f71c5a5b6cfb8e6e4539215ee64",u),(0,r.j)("9fbcb98e24d6110a0b651815b3dadf15b502bddb",f),(0,r.j)("6c398ab10f2fe5ca7c3c7cbd4441f8985ac0b2c0",m),(0,r.j)("f0235452ffb2df1c718dadedfed3036abcd44c64",b),(0,r.j)("01b0d69a5187a2f6751a53fdd3d1b57966d6ab1d",g),(0,r.j)("c13933359a981604722d005f388987c4c280ffc0",v),(0,r.j)("b20bbb579c4cb4710038b3c4410ec7a88ff7e5c1",j),(0,r.j)("f7cdbcc96d6fb36d93e2e9e7b04ef4209e5c7d45",q),(0,r.j)("8b15b5582c5e392c34774ef8dba5fac65aa38690",$),(0,r.j)("37f42b7663f1cbf706fa9cbcb3a0916a90e14bd7",A)},82208:(e,t,a)=>{a.d(t,{L:()=>s});var r=a(53524);let s=globalThis.prisma||new r.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[9379,1309,9354,7715,5841,8543],()=>a(13725));module.exports=r})();